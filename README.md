# yh_parser

Парсер yaml конфигурации со встроенным **процедурным** скриптовым языком
для генерации парсеров (преимущественно под html) на различных языки программирования

## Минимальные требования к целевому портируемому ЯП:
- есть регулярные выражения
- есть css/xpath библиотека/библиотеки
- базовые методы работы со строками

## Спецификация синтаксиса

### Описание типов
Для данного скриптого языка существуют 3 типа данных

| Тип      | Описание                        |
|----------|---------------------------------|
| SELECTOR | объект для работы с селекторами |
| TEXT     | строка                          |
| ARRAY    | динамический массив строк       |

### Описание токенов
| Оператор | Аргументы         | Описание                                                                                                                                                | Возвращаемое значение | Пример                              |
|----------|-------------------|---------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------|-------------------------------------|
| xpath    | "<expr>"          | xpath селектор первого значения                                                                                                                         | SELECTOR              | xpath "//title"                     |
| xpathAll | "<expr>"          | xpath селектор всех значений                                                                                                                            | SELECTOR              | xpathAll "//div"                    |
| css      | "<expr>"          | css селектор первого значения                                                                                                                           | SELECTOR              | css "title"                         |
| cssAll   | "<expr>"          | css селектор всех значений                                                                                                                              | SELECTOR              | cssAll "div > a"                    |
| attr     | "<tag attr>"      | получить тег(и). Вызывается после xpath/xpathAll/css/cssAll                                                                                             | TEXT/ARRAY            | attr "href"                         |
| text     |                   | получить текст внутри тега. Вызывается после xpath/xpathAll/css/cssAll. Может быть вызван первой строкой для полного перевода объекта селектора в текст | TEXT/ARRAY            | text                                |
| raw      |                   | получить сырой тег в виде текста. Вызывается после xpath/xpathAll/css/cssAll                                                                            | TEXT/ARRAY            | raw                                 |
| re       | "<exrp>"          | регулярное выражение. Возвращает первый найденный элемент. Аргумент должен быть TEXT                                                                    | TEXT                  | re "(\d+)"                          |
| reAll    | "<expr>"          | регулярное выражение. Возвращает все найденные элементы. Аргумент должен быть TEXT                                                                      | ARRAY                 | reAll "(\d+)"                       |
| reSub    | "<expr>" "<repl>" | Замена по регулярному выражение. Аргумент должен быть TEXT                                                                                              | TEXT                  | reSub "(\d+)" "digit(lol)"          |
| strip    | "<string>"        | Удаляет заданную строку СЛЕВА и СПРАВА. Аргумент должен быть TEXT                                                                                       | TEXT                  | strip "\n"                          |
| lstrip   | "<string>"        | Удаляет заданную строку СЛЕВА. Аргумент должен быть TEXT                                                                                                | TEXT                  | lstrip " "                          |
| rstrip   | "<string>"        | Удаляет заданную строку СПРАВА. Аргумент должен быть TEXT                                                                                               | TEXT                  | rstrip " "                          |
| format   | "<string>"        | Format string. Аргумент подстановки указывать с помощью `{{}}` оператора. Аргумент должен быть TEXT                                                     | TEXT                  | format "spam {{}} egg"              |
| split    | "<value>" <count> | Разделение строки. Если count = -1 - делить на максимально доступное. Аргумент должен быть TEXT                                                         | ARRAY                 | default "empty"                     |
| default  | <value>           | Значение по умолчанию, если произошла ошибка во время парсинга. Указывается первым.                                                                     | -                     | default "empty"                     |
| slice    | <start> <end>     | Срез массива. Аргумент должен быть ARRAY. поддерживает отрицательные индексы                                                                            | ARRAY                 | slice 1 5 / slice 1 # `[1..]` алиас |
| index    | <index>           | Взять элемент по индекса. Аргумент должен быть ARRAY                                                                                                    | TEXT                  | index 1                             |
| first    |                   | Алиас `index 1` команды                                                                                                                                 |                       | first                               |
| last     |                   | Алиас `index -1` команды                                                                                                                                |                       | last                                |
| join     | "<string>"        | Собирает ARRAY в строку. Аргумент должен быть ARRAY                                                                                                     |                       | join ", "                           |

### Особенности
1. В начале указывается команда `defalut`, если необходимо проигнорировать ошибку и вернуть значение по умолчанию
2. На вход идет инстанс `SELECTOR`
3. Минималистичность данного скриптового ЯП и отсутствия полноты по Тьюрингу обуславливается конкретным назначением - 
токенизировать список инструкций для последующей генерации кода html-парсера на целевом языке.
4. Синтаксис регулярных выражений используется python
5. Арифметические, логические и приоритета операции не планируются.
6. Возвращаемый тип данных - строка или лист со строками

## example
```
// set default value if parse process is failing
defalut 0
xpath "//title"
text
format "Cool title: {{}}"
```

## yaml config
TODO

## Write codegen
TODO

## TODO
- конвертер xpath -> css, css -> xpath на этапе генерации
- шаблоны генерации
- методы строк: `title`, `upper`, `lower`, `capitalize`
- ретранслятор регулярных выражений для универсальности применения. Например `\d` в `[0-9]`